<div class="management-container">
  <!-- Header -->
  <div class="management-header">
    <div class="header-content">
      <h1>
        <i class="fas fa-exclamation-triangle"></i>
        Quản lý bất thường Database
      </h1>
      <p>Phát hiện và theo dõi các truy vấn SQL bất thường</p>
    </div>
    
    <div class="header-actions">
      <button class="btn btn-primary" (click)="refreshData()" [disabled]="isLoading">
        <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
        Làm mới
      </button>
      <button class="btn btn-secondary" (click)="goBack()">
        <i class="fas fa-arrow-left"></i>
        Quay lại
      </button>
      <button class="btn btn-outline" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        Đăng xuất
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Đang tải dữ liệu log bất thường...</p>
    </div>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading" class="management-card">
    <!-- No Data Message -->
    <div *ngIf="!hasData" class="no-data-container">
      <div class="no-data-content">
        <i class="fas fa-shield-check"></i>
        <h3>Không phát hiện truy vấn bất thường nào</h3>
        <p>Hệ thống đang hoạt động bình thường, không có truy vấn SQL nào vượt quá ngưỡng cảnh báo.</p>
      </div>
    </div>

    <!-- Data Table -->
    <div *ngIf="hasData" class="table-container">
      <div class="table-header">
        <h3>
          <i class="fas fa-list"></i>
          Danh sách Log Bất thường
        </h3>
        <div class="table-info">
          <span class="total-info">
            <i class="fas fa-database"></i>
            Tổng số bản ghi: <strong>{{ totalElements }}</strong>
          </span>
          <div class="page-size-selector">
            <label for="pageSizeSelect">
              <i class="fas fa-list"></i>
              Hiển thị:
            </label>
            <select 
              id="pageSizeSelect" 
              [(ngModel)]="pageSize" 
              (change)="onPageSizeSelectChange($event)"
              class="page-size-select"
              [disabled]="isPaginationLoading"
            >
              <option *ngFor="let size of pageSizeOptions" [value]="size">
                {{ size }} bản ghi
              </option>
            </select>
          </div>
        </div>
      </div>

      <div class="table-wrapper">
        <table class="management-table">
            <thead>
              <tr>
                <th class="col-database">
                  <i class="fas fa-database"></i>
                  Database
                </th>
                <th class="col-sql">
                  <i class="fas fa-code"></i>
                  Câu lệnh SQL
                </th>
                <th class="col-time">
                  <i class="fas fa-clock"></i>
                  Thời gian thực thi
                </th>
                <th class="col-count">
                  <i class="fas fa-repeat"></i>
                  Số lần thực hiện
                </th>
                <th class="col-warning">
                  <i class="fas fa-exclamation-triangle"></i>
                  Chỉ báo
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let log of unexpectedLogs; let i = index" class="table-row" [class.unexpected]="isUnexpected(log)">
                <td class="col-database">
                  <div class="database-info">
                    <span class="database-label">
                      <i class="fas fa-database"></i>
                      {{ log.database_name }}
                    </span>
                  </div>
                </td>
                <td class="col-sql">
                  <div class="sql-content">
                    <code class="sql-query">{{ log.sql }}</code>
                  </div>
                </td>
                <td class="col-time">
                  <div class="time-info">
                    <span class="execution-time-label" [ngClass]="log.exec_time > 500 ? 'slow' : 'fast'">
                      <i class="fas fa-clock"></i>
                      {{ log.exec_time }}
                    </span>
                    <small class="time-label">thời gian thực thi</small>
                  </div>
                </td>
                <td class="col-count">
                  <div class="count-info">
                    <span class="execution-count-label" [ngClass]="log.exe_count > 100 ? 'high' : 'normal'">
                      <i class="fas fa-repeat"></i>
                      {{ log.exe_count }}
                    </span>
                    <small class="count-label">lần thực hiện</small>
                  </div>
                </td>
                <td class="col-warning">
                  <div class="warning-info" *ngIf="isUnexpected(log)">
                    <span class="warning-badge">
                      <i class="fas fa-exclamation-triangle"></i>
                      Warning
                    </span>
                    <small class="warning-desc">{{ getWarningMessage(log) }}</small>
                  </div>
                  <div class="normal-info" *ngIf="!isUnexpected(log)">
                    <span class="normal-badge">
                      <i class="fas fa-check-circle"></i>
                      Normal
                    </span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" *ngIf="totalPages > 1">
          <div class="pagination-info">
            <span class="page-info">
              <i class="fas fa-info-circle"></i>
              Hiển thị {{ getCurrentPageInfo() }} bản ghi
            </span>
            <span class="page-info">
              <i class="fas fa-layer-group"></i>
              Trang {{ currentPage + 1 }} / {{ totalPages }}
            </span>
          </div>
          
          <div class="pagination-controls">
            <!-- First Page Button -->
            <button 
              class="btn btn-pagination btn-first" 
              (click)="goToPage(0)" 
              [disabled]="!canGoPrevious() || isPaginationLoading"
              title="Trang đầu"
            >
              <i class="fas fa-angle-double-left"></i>
            </button>
            
            <!-- Previous Page Button -->
            <button 
              class="btn btn-pagination" 
              (click)="previousPage()" 
              [disabled]="!canGoPrevious() || isPaginationLoading"
              title="Trang trước"
            >
              <i class="fas fa-chevron-left"></i>
              Trước
            </button>
            
            <!-- Page Numbers -->
            <div class="page-numbers">
              <button 
                *ngFor="let page of getPageNumbers()" 
                class="btn btn-page" 
                [class.active]="page === currentPage"
                [disabled]="isPaginationLoading"
                (click)="goToPage(page)"
                [title]="'Trang ' + (page + 1)"
              >
                {{ page + 1 }}
              </button>
            </div>
            
            <!-- Next Page Button -->
            <button 
              class="btn btn-pagination" 
              (click)="nextPage()" 
              [disabled]="!canGoNext() || isPaginationLoading"
              title="Trang sau"
            >
              Sau
              <i class="fas fa-chevron-right"></i>
            </button>
            
            <!-- Last Page Button -->
            <button 
              class="btn btn-pagination btn-last" 
              (click)="goToPage(totalPages - 1)" 
              [disabled]="!canGoNext() || isPaginationLoading"
              title="Trang cuối"
            >
              <i class="fas fa-angle-double-right"></i>
            </button>
          </div>
          
          <!-- Pagination Loading Indicator -->
          <div class="pagination-loading" *ngIf="isPaginationLoading">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Đang tải...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
