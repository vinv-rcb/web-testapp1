<div class="management-container">
  <!-- Header -->
  <div class="management-header">
    <div class="header-content">
      <h1>
        <i class="fas fa-database"></i>
        Quản lý Log Database
      </h1>
      <p>Theo dõi và quản lý log thực thi SQL trên các database</p>
    </div>
    
    <div class="header-actions">

      <button class="btn btn-primary" (click)="refreshData()" [disabled]="isLoadingLogs">
        <i class="fas fa-sync-alt" [class.fa-spin]="isLoadingLogs"></i>
        Làm mới
      </button>
      <button class="btn btn-secondary" (click)="goBack()">
        <i class="fas fa-arrow-left"></i>
        Quay lại
      </button>
      <button class="btn btn-outline" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        Đăng xuất
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Đang tải danh sách database...</p>
    </div>
  </div>

  <!-- Logs Table -->
  <div *ngIf="!isLoading" class="management-card">
    <div class="table-container">
      <div class="table-header">
        <h3>
          <i class="fas fa-list"></i>
          Danh sách Log SQL
        </h3>
        <div class="table-info">
          <span class="total-info">
            <i class="fas fa-database"></i>
            Tổng số bản ghi: <strong>{{ totalElements }}</strong>
          </span>
          <div class="page-size-selector">
            <label for="pageSizeSelect">
              <i class="fas fa-list"></i>
              Hiển thị:
            </label>
            <select 
              id="pageSizeSelect" 
              [(ngModel)]="pageSize" 
              (change)="onPageSizeSelectChange($event)"
              class="page-size-select"
              [disabled]="isPaginationLoading"
            >
              <option *ngFor="let size of (pageSizeOptions || [])" [value]="size">
                {{ size }} bản ghi
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="filter-section">
        <div class="filter-content">
          <div class="filter-group">
            <label for="databaseSelect">
              <i class="fas fa-filter"></i>
              Chọn Database:
            </label>
            <select 
              id="databaseSelect"
              [(ngModel)]="selectedDatabase"
              (change)="onDatabaseChange()"
              class="form-select"
              [disabled]="isLoading"
            >
              <option 
                *ngFor="let db of (databaseList || [])" 
                [value]="db.database_name"
              >
                {{ db.database_name }}
              </option>
            </select>
          </div>
          
          <div class="filter-info">
            <span class="info-text">
              <i class="fas fa-info-circle"></i>
              Hiển thị log cho: <strong>{{ selectedDatabase }}</strong>
            </span>
          </div>
        </div>
      </div>

      <!-- Loading Logs -->
      <div *ngIf="isLoadingLogs" class="loading-logs">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Đang tải dữ liệu log...</p>
        </div>
      </div>

      <!-- Table -->
      <div *ngIf="!isLoadingLogs" class="table-wrapper">
        <table class="management-table">
          <thead>
            <tr>
              <th class="col-database">
                <i class="fas fa-database"></i>
                Tên Database
              </th>
              <th class="col-sql">
                <i class="fas fa-code"></i>
                SQL Query
              </th>
              <th class="col-time">
                <i class="fas fa-clock"></i>
                Thời gian xử lý
              </th>
              <th class="col-count">
                <i class="fas fa-repeat"></i>
                Số lần chạy
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="logList.length === 0" class="no-data">
              <td colspan="4">
                <div class="no-data-content">
                  <i class="fas fa-inbox"></i>
                  <h3>Không có dữ liệu log</h3>
                  <p>Chọn database khác hoặc thử lại sau</p>
                </div>
              </td>
            </tr>
            <tr *ngFor="let log of (logList || []); let i = index" class="table-row">
              <td class="col-database">
                <div class="database-info">
                  <span class="database-label">
                    <i class="fas fa-database"></i>
                    {{ log.database_name }}
                  </span>
                </div>
              </td>
              <td class="col-sql">
                <div class="sql-content">
                  <code class="sql-query">{{ log.sql }}</code>
                </div>
              </td>
              <td class="col-time">
                <div class="time-info">
                  <span class="execution-time-label" [ngClass]="log.exec_time > 1000 ? 'slow' : 'fast'">
                    <i class="fas fa-clock"></i>
                    {{ log.exec_time }}
                  </span>
                </div>
              </td>
              <td class="col-count">
                <div class="count-info">
                  <span class="execution-count-label" [ngClass]="log.exe_count > 100 ? 'high' : 'normal'">
                    <i class="fas fa-repeat"></i>
                    {{ log.exe_count }}
                  </span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination-container" *ngIf="!isLoadingLogs && totalPages > 1">
        <div class="pagination-info">
          <span class="page-info">
            <i class="fas fa-info-circle"></i>
            Hiển thị {{ getCurrentPageInfo() }} bản ghi
          </span>
          <span class="page-info">
            <i class="fas fa-layer-group"></i>
            Trang {{ currentPage + 1 }} / {{ totalPages }}
          </span>
        </div>
        
        <div class="pagination-controls">
          <!-- First Page Button -->
          <button 
            class="btn btn-pagination btn-first" 
            (click)="goToPage(0)" 
            [disabled]="!canGoPrevious() || isPaginationLoading"
            title="Trang đầu"
          >
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <!-- Previous Page Button -->
          <button 
            class="btn btn-pagination" 
            (click)="previousPage()" 
            [disabled]="!canGoPrevious() || isPaginationLoading"
            title="Trang trước"
          >
            <i class="fas fa-chevron-left"></i>
            Trước
          </button>
          
          <!-- Page Numbers -->
          <div class="page-numbers">
            <button 
              *ngFor="let page of (getPageNumbers() || [])" 
              class="btn btn-page" 
              [class.active]="page === currentPage"
              [disabled]="isPaginationLoading"
              (click)="goToPage(page)"
              [title]="'Trang ' + (page + 1)"
            >
              {{ page + 1 }}
            </button>
          </div>
          
          <!-- Next Page Button -->
          <button 
            class="btn btn-pagination" 
            (click)="nextPage()" 
            [disabled]="!canGoNext() || isPaginationLoading"
            title="Trang sau"
          >
            Sau
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <!-- Last Page Button -->
          <button 
            class="btn btn-pagination btn-last" 
            (click)="goToPage(totalPages - 1)" 
            [disabled]="!canGoNext() || isPaginationLoading"
            title="Trang cuối"
          >
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <!-- Pagination Loading Indicator -->
        <div class="pagination-loading" *ngIf="isPaginationLoading">
          <i class="fas fa-spinner fa-spin"></i>
          <span>Đang tải...</span>
        </div>
      </div>
    </div>
  </div>
</div>